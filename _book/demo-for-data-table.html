<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Demo for Data.table | Codes for STEM</title>
  <meta name="description" content="This is a collection of codes for analytics projects from import, wrangling, analyzing, visualizing, to reporting" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Demo for Data.table | Codes for STEM" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of codes for analytics projects from import, wrangling, analyzing, visualizing, to reporting" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Demo for Data.table | Codes for STEM" />
  
  <meta name="twitter:description" content="This is a collection of codes for analytics projects from import, wrangling, analyzing, visualizing, to reporting" />
  

<meta name="author" content="Noushin Nabavi" />


<meta name="date" content="2020-09-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="working-with-dates-in-r.html"/>
<link rel="next" href="tests-for-experiments.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Coding for STEM</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="useful-r-functions-examples.html"><a href="useful-r-functions-examples.html"><i class="fa fa-check"></i><b>3</b> Useful R Functions + Examples</a><ul>
<li class="chapter" data-level="3.1" data-path="useful-r-functions-examples.html"><a href="useful-r-functions-examples.html#contents"><i class="fa fa-check"></i><b>3.1</b> Contents</a></li>
<li class="chapter" data-level="3.2" data-path="useful-r-functions-examples.html"><a href="useful-r-functions-examples.html#r-syntax"><i class="fa fa-check"></i><b>3.2</b> R Syntax</a></li>
<li class="chapter" data-level="3.3" data-path="useful-r-functions-examples.html"><a href="useful-r-functions-examples.html#functional-examples"><i class="fa fa-check"></i><b>3.3</b> Functional examples</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="demo-for-dplyr.html"><a href="demo-for-dplyr.html"><i class="fa fa-check"></i><b>4</b> Demo for dplyr</a></li>
<li class="chapter" data-level="5" data-path="working-with-dates-in-r.html"><a href="working-with-dates-in-r.html"><i class="fa fa-check"></i><b>5</b> Working with dates in R</a></li>
<li class="chapter" data-level="6" data-path="demo-for-data-table.html"><a href="demo-for-data-table.html"><i class="fa fa-check"></i><b>6</b> Demo for Data.table</a></li>
<li class="chapter" data-level="7" data-path="tests-for-experiments.html"><a href="tests-for-experiments.html"><i class="fa fa-check"></i><b>7</b> Tests for experiments</a></li>
<li class="chapter" data-level="8" data-path="demo-for-ab-testing.html"><a href="demo-for-ab-testing.html"><i class="fa fa-check"></i><b>8</b> Demo for A/B testing</a></li>
<li class="chapter" data-level="9" data-path="working-with-time-series-in-r.html"><a href="working-with-time-series-in-r.html"><i class="fa fa-check"></i><b>9</b> Working with time-series in R</a></li>
<li class="chapter" data-level="10" data-path="feature-engineering-in-r.html"><a href="feature-engineering-in-r.html"><i class="fa fa-check"></i><b>10</b> Feature engineering in R</a></li>
<li class="chapter" data-level="11" data-path="impute-missingness.html"><a href="impute-missingness.html"><i class="fa fa-check"></i><b>11</b> Impute missingness</a></li>
<li class="chapter" data-level="12" data-path="r-for-reporting.html"><a href="r-for-reporting.html"><i class="fa fa-check"></i><b>12</b> R for Reporting</a><ul>
<li class="chapter" data-level="12.1" data-path="r-for-reporting.html"><a href="r-for-reporting.html#usage-demonstrations"><i class="fa fa-check"></i><b>12.1</b> Usage demonstrations</a><ul>
<li class="chapter" data-level="12.1.1" data-path="r-for-reporting.html"><a href="r-for-reporting.html#inline-code"><i class="fa fa-check"></i><b>12.1.1</b> Inline code</a></li>
<li class="chapter" data-level="12.1.2" data-path="r-for-reporting.html"><a href="r-for-reporting.html#code-chunks"><i class="fa fa-check"></i><b>12.1.2</b> Code chunks</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="r-for-reporting.html"><a href="r-for-reporting.html#resources"><i class="fa fa-check"></i><b>12.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-for-reporting.html"><a href="r-for-reporting.html#resources"><i class="fa fa-check"></i>Resources</a><ul>
<li class="chapter" data-level="12.3" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>12.3</b> Beginner Resources by Topic</a><ul>
<li class="chapter" data-level="12.3.1" data-path="resources.html"><a href="resources.html#getting-set-up-with-r-rstudio"><i class="fa fa-check"></i><b>12.3.1</b> Getting Set-Up with R &amp; RStudio</a></li>
<li class="chapter" data-level="12.3.2" data-path="resources.html"><a href="resources.html#specialist-topics"><i class="fa fa-check"></i><b>12.3.2</b> Specialist Topics</a></li>
<li class="chapter" data-level="12.3.3" data-path="resources.html"><a href="resources.html#operational-basics"><i class="fa fa-check"></i><b>12.3.3</b> Operational Basics</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Codes for STEM</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="demo-for-data.table" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Demo for Data.table</h1>
<p>Load libraries:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="co"># Load data.table</span></a>
<a class="sourceLine" id="cb177-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb177-3" data-line-number="3"><span class="kw">library</span>(bikeshare14)</a>
<a class="sourceLine" id="cb177-4" data-line-number="4"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>Create the data.table:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">X &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dt">value =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"></a>
<a class="sourceLine" id="cb178-3" data-line-number="3"><span class="kw">print</span>(X)</a></code></pre></div>
<pre><code>##    id value
## 1:  a   0.5
## 2:  b   1.0
## 3:  c   1.5</code></pre>
<p>Get number of columns in batrips:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1">batrips &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(batrips)</a>
<a class="sourceLine" id="cb180-2" data-line-number="2">col_number &lt;-<span class="st"> </span><span class="kw">ncol</span>(batrips)</a>
<a class="sourceLine" id="cb180-3" data-line-number="3">col_number</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>Print the first 4 rows:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1"><span class="kw">head</span>(batrips, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station start_terminal
## 1:  139545      435 2014-01-01 00:14:00 San Francisco City Hall             58
## 2:  139546      432 2014-01-01 00:14:00 San Francisco City Hall             58
## 3:  139547     1523 2014-01-01 00:17:00  Embarcadero at Sansome             60
## 4:  139549     1620 2014-01-01 00:23:00       Steuart at Market             74
##               end_date        end_station end_terminal bike_id
## 1: 2014-01-01 00:21:00    Townsend at 7th           65     473
## 2: 2014-01-01 00:21:00    Townsend at 7th           65     395
## 3: 2014-01-01 00:42:00    Beale at Market           56     331
## 4: 2014-01-01 00:50:00 Powell Street BART           39     605
##    subscription_type zip_code
## 1:        Subscriber    94612
## 2:        Subscriber    94107
## 3:        Subscriber    94112
## 4:          Customer    92007</code></pre>
<p>Print the last 4 rows:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="kw">tail</span>(batrips, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date                   start_station
## 1:  588911      422 2014-12-31 23:19:00 Grant Avenue at Columbus Avenue
## 2:  588912     1487 2014-12-31 23:31:00        South Van Ness at Market
## 3:  588913     1458 2014-12-31 23:32:00        South Van Ness at Market
## 4:  588914      364 2014-12-31 23:33:00           Embarcadero at Bryant
##    start_terminal            end_date
## 1:             73 2014-12-31 23:26:00
## 2:             66 2014-12-31 23:56:00
## 3:             66 2014-12-31 23:56:00
## 4:             54 2014-12-31 23:40:00
##                                      end_station end_terminal bike_id
## 1: Yerba Buena Center of the Arts (3rd @ Howard)           68     604
## 2:                             Steuart at Market           74     480
## 3:                             Steuart at Market           74     277
## 4:                                 Howard at 2nd           63      56
##    subscription_type zip_code
## 1:        Subscriber    94133
## 2:          Customer    94109
## 3:          Customer    94109
## 4:        Subscriber    94105</code></pre>
<p>Print the structure of batrips:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="kw">str</span>(batrips)</a></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:	326339 obs. of  11 variables:
##  $ trip_id          : int  139545 139546 139547 139549 139550 139551 139552 139553 139554 139555 ...
##  $ duration         : int  435 432 1523 1620 1617 779 784 721 624 574 ...
##  $ start_date       : POSIXct, format: &quot;2014-01-01 00:14:00&quot; &quot;2014-01-01 00:14:00&quot; ...
##  $ start_station    : chr  &quot;San Francisco City Hall&quot; &quot;San Francisco City Hall&quot; &quot;Embarcadero at Sansome&quot; &quot;Steuart at Market&quot; ...
##  $ start_terminal   : int  58 58 60 74 74 74 74 74 57 57 ...
##  $ end_date         : POSIXct, format: &quot;2014-01-01 00:21:00&quot; &quot;2014-01-01 00:21:00&quot; ...
##  $ end_station      : chr  &quot;Townsend at 7th&quot; &quot;Townsend at 7th&quot; &quot;Beale at Market&quot; &quot;Powell Street BART&quot; ...
##  $ end_terminal     : int  65 65 56 39 39 46 46 46 68 68 ...
##  $ bike_id          : int  473 395 331 605 453 335 580 563 358 365 ...
##  $ subscription_type: chr  &quot;Subscriber&quot; &quot;Subscriber&quot; &quot;Subscriber&quot; &quot;Customer&quot; ...
##  $ zip_code         : chr  &quot;94612&quot; &quot;94107&quot; &quot;94112&quot; &quot;92007&quot; ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Filter third row:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">row_<span class="dv">3</span> &lt;-<span class="st"> </span>batrips[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb188-2" data-line-number="2">row_<span class="dv">3</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date          start_station start_terminal
## 1:  139547     1523 2014-01-01 00:17:00 Embarcadero at Sansome             60
##               end_date     end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 00:42:00 Beale at Market           56     331        Subscriber
##    zip_code
## 1:    94112</code></pre>
<p>Filter rows 1 through 2:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">rows_<span class="dv">1</span>_<span class="dv">2</span> &lt;-<span class="st"> </span>batrips[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb190-2" data-line-number="2">rows_<span class="dv">1</span>_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station start_terminal
## 1:  139545      435 2014-01-01 00:14:00 San Francisco City Hall             58
## 2:  139546      432 2014-01-01 00:14:00 San Francisco City Hall             58
##               end_date     end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 00:21:00 Townsend at 7th           65     473        Subscriber
## 2: 2014-01-01 00:21:00 Townsend at 7th           65     395        Subscriber
##    zip_code
## 1:    94612
## 2:    94107</code></pre>
<p>Filter the 1st, 6th and 10th rows:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">rows_<span class="dv">1</span>_<span class="dv">6</span>_<span class="dv">10</span> &lt;-<span class="st"> </span>batrips[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">10</span>)]</a>
<a class="sourceLine" id="cb192-2" data-line-number="2">rows_<span class="dv">1</span>_<span class="dv">6</span>_<span class="dv">10</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station start_terminal
## 1:  139545      435 2014-01-01 00:14:00 San Francisco City Hall             58
## 2:  139551      779 2014-01-01 00:24:00       Steuart at Market             74
## 3:  139555      574 2014-01-01 00:25:00           5th at Howard             57
##               end_date                                   end_station
## 1: 2014-01-01 00:21:00                               Townsend at 7th
## 2: 2014-01-01 00:37:00                         Washington at Kearney
## 3: 2014-01-01 00:35:00 Yerba Buena Center of the Arts (3rd @ Howard)
##    end_terminal bike_id subscription_type zip_code
## 1:           65     473        Subscriber    94612
## 2:           46     335          Customer    94109
## 3:           68     365          Customer    94941</code></pre>
<p>Select all rows except the first two:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">not_first_two &lt;-<span class="st"> </span>batrips[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb194-2" data-line-number="2">not_first_two <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date          start_station start_terminal
## 1:  139547     1523 2014-01-01 00:17:00 Embarcadero at Sansome             60
## 2:  139549     1620 2014-01-01 00:23:00      Steuart at Market             74
##               end_date        end_station end_terminal bike_id
## 1: 2014-01-01 00:42:00    Beale at Market           56     331
## 2: 2014-01-01 00:50:00 Powell Street BART           39     605
##    subscription_type zip_code
## 1:        Subscriber    94112
## 2:          Customer    92007</code></pre>
<p>Select all rows except 1 through 5 and 10 through 15:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">exclude_some &lt;-<span class="st"> </span>batrips[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">15</span>)]</a>
<a class="sourceLine" id="cb196-2" data-line-number="2">exclude_some <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date     start_station start_terminal
## 1:  139551      779 2014-01-01 00:24:00 Steuart at Market             74
## 2:  139552      784 2014-01-01 00:24:00 Steuart at Market             74
##               end_date           end_station end_terminal bike_id
## 1: 2014-01-01 00:37:00 Washington at Kearney           46     335
## 2: 2014-01-01 00:37:00 Washington at Kearney           46     580
##    subscription_type zip_code
## 1:          Customer    94109
## 2:          Customer</code></pre>
<p>Select all rows except the first and last:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">not_first_last &lt;-<span class="st"> </span>batrips[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, .N)] </a>
<a class="sourceLine" id="cb198-2" data-line-number="2"><span class="co"># Or</span></a>
<a class="sourceLine" id="cb198-3" data-line-number="3"><span class="co"># batrips[-c(1, nrow(batrips))]</span></a>
<a class="sourceLine" id="cb198-4" data-line-number="4"></a>
<a class="sourceLine" id="cb198-5" data-line-number="5">not_first_last <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-6" data-line-number="6"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station start_terminal
## 1:  139546      432 2014-01-01 00:14:00 San Francisco City Hall             58
## 2:  139547     1523 2014-01-01 00:17:00  Embarcadero at Sansome             60
##               end_date     end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 00:21:00 Townsend at 7th           65     395        Subscriber
## 2: 2014-01-01 00:42:00 Beale at Market           56     331        Subscriber
##    zip_code
## 1:    94107
## 2:    94112</code></pre>
<p>Filter all rows where start_station is “Market at 10th”:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">trips_mlk &lt;-<span class="st"> </span>batrips[start_station <span class="op">==</span><span class="st"> &quot;Market at 10th&quot;</span>]</a>
<a class="sourceLine" id="cb200-2" data-line-number="2">trips_mlk <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date  start_station start_terminal
## 1:  139605     1352 2014-01-01 07:40:00 Market at 10th             67
## 2:  139609     1130 2014-01-01 08:08:00 Market at 10th             67
##               end_date    end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 08:03:00 Market at 10th           67     545        Subscriber
## 2: 2014-01-01 08:27:00 Market at 10th           67     545        Subscriber
##    zip_code
## 1:    94590
## 2:    94590</code></pre>
<p>Filter all rows where start_station is “MLK Library” AND duration &gt; 1600:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">trips_mlk_<span class="dv">1600</span> &lt;-<span class="st"> </span>batrips[start_station <span class="op">==</span><span class="st"> &quot;MLK Library&quot;</span> <span class="op">&amp;</span><span class="st"> </span>duration <span class="op">&gt;</span><span class="st"> </span><span class="dv">1600</span>]</a>
<a class="sourceLine" id="cb202-2" data-line-number="2">trips_mlk_<span class="dv">1600</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date start_station start_terminal
## 1:  147733     1744 2014-01-09 11:47:00   MLK Library             11
## 2:  158900    61848 2014-01-19 16:42:00   MLK Library             11
##               end_date           end_station end_terminal bike_id
## 1: 2014-01-09 12:16:00    San Jose City Hall           10     691
## 2: 2014-01-20 09:52:00 San Jose Civic Center            3      86
##    subscription_type zip_code
## 1:        Subscriber    95112
## 2:          Customer    95608</code></pre>
<p>Filter all rows where <code>subscription_type</code> is not <code>&quot;Subscriber&quot;</code>::</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">customers &lt;-<span class="st"> </span>batrips[subscription_type <span class="op">!=</span><span class="st"> &quot;Subscriber&quot;</span>]</a>
<a class="sourceLine" id="cb204-2" data-line-number="2">customers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date     start_station start_terminal
## 1:  139549     1620 2014-01-01 00:23:00 Steuart at Market             74
## 2:  139550     1617 2014-01-01 00:23:00 Steuart at Market             74
##               end_date        end_station end_terminal bike_id
## 1: 2014-01-01 00:50:00 Powell Street BART           39     605
## 2: 2014-01-01 00:50:00 Powell Street BART           39     453
##    subscription_type zip_code
## 1:          Customer    92007
## 2:          Customer    92007</code></pre>
<p>Filter all rows where start_station is “Ryland Park” AND subscription_type is not “Customer”:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">ryland_park_subscribers &lt;-<span class="st"> </span>batrips[start_station <span class="op">==</span><span class="st"> &quot;Ryland Park&quot;</span> <span class="op">&amp;</span><span class="st"> </span>subscription_type <span class="op">!=</span><span class="st"> &quot;Customer&quot;</span>]</a>
<a class="sourceLine" id="cb206-2" data-line-number="2">ryland_park_subscribers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb206-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date start_station start_terminal
## 1:  243456      330 2014-04-10 09:10:00   Ryland Park             84
## 2:  244497      594 2014-04-11 07:28:00   Ryland Park             84
##               end_date                       end_station end_terminal bike_id
## 1: 2014-04-10 09:16:00                         Japantown            9      23
## 2: 2014-04-11 07:38:00 San Jose Diridon Caltrain Station            2      54
##    subscription_type zip_code
## 1:        Subscriber    95110
## 2:        Subscriber    95110</code></pre>
<p>Filter all rows where end_station contains “Market”:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">any_markets &lt;-<span class="st"> </span>batrips[end_station <span class="op">%like%</span><span class="st"> &quot;Market&quot;</span>]</a>
<a class="sourceLine" id="cb208-2" data-line-number="2">any_markets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date                        start_station
## 1:  139547     1523 2014-01-01 00:17:00               Embarcadero at Sansome
## 2:  139558     1600 2014-01-01 00:28:00 Harry Bridges Plaza (Ferry Building)
##    start_terminal            end_date       end_station end_terminal bike_id
## 1:             60 2014-01-01 00:42:00   Beale at Market           56     331
## 2:             50 2014-01-01 00:54:00 Steuart at Market           74     413
##    subscription_type zip_code
## 1:        Subscriber    94112
## 2:        Subscriber    94102</code></pre>
<p>Filter all rows where trip_id is 588841, 139560, or 139562:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">filter_trip_ids &lt;-<span class="st"> </span>batrips[trip_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">588841</span>, <span class="dv">139560</span>, <span class="dv">139562</span>)]</a>
<a class="sourceLine" id="cb210-2" data-line-number="2">filter_trip_ids <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date     start_station start_terminal
## 1:  139560     3793 2014-01-01 00:32:00 Steuart at Market             74
## 2:  139562     3626 2014-01-01 00:33:00 Steuart at Market             74
##               end_date       end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 01:35:00 Steuart at Market           74     311          Customer
## 2: 2014-01-01 01:33:00 Steuart at Market           74     271          Customer
##    zip_code
## 1:    55417
## 2:    94070</code></pre>
<p>Filter all rows where duration is between [5000, 6000]:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">duration_5k_6k &lt;-<span class="st"> </span>batrips[duration <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">5000</span>, <span class="dv">6000</span>)]</a>
<a class="sourceLine" id="cb212-2" data-line-number="2">duration_5k_6k <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb212-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date     start_station start_terminal
## 1:  139607     5987 2014-01-01 07:57:00 Market at Sansome             77
## 2:  139608     5974 2014-01-01 07:57:00 Market at Sansome             77
##               end_date                     end_station end_terminal bike_id
## 1: 2014-01-01 09:37:00 Grant Avenue at Columbus Avenue           73     591
## 2: 2014-01-01 09:37:00 Grant Avenue at Columbus Avenue           73     596
##    subscription_type zip_code
## 1:          Customer    75201
## 2:          Customer    75201</code></pre>
<p>Filter all rows with specific start stations:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1">two_stations &lt;-<span class="st"> </span>batrips[start_station <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;San Francisco City Hall&quot;</span>, <span class="st">&quot;Embarcadero at Sansome&quot;</span>)]</a>
<a class="sourceLine" id="cb214-2" data-line-number="2">two_stations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station start_terminal
## 1:  139545      435 2014-01-01 00:14:00 San Francisco City Hall             58
## 2:  139546      432 2014-01-01 00:14:00 San Francisco City Hall             58
##               end_date     end_station end_terminal bike_id subscription_type
## 1: 2014-01-01 00:21:00 Townsend at 7th           65     473        Subscriber
## 2: 2014-01-01 00:21:00 Townsend at 7th           65     395        Subscriber
##    zip_code
## 1:    94612
## 2:    94107</code></pre>
<p>Selecting columns from a data.table
Select bike_id and trip_id using a character vector:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1">df_way &lt;-<span class="st"> </span>batrips[, <span class="kw">c</span>(<span class="st">&quot;bike_id&quot;</span>, <span class="st">&quot;trip_id&quot;</span>)]</a>
<a class="sourceLine" id="cb216-2" data-line-number="2">df_way <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    bike_id trip_id
## 1:     473  139545
## 2:     395  139546</code></pre>
<p>Select start_station and end_station cols without a character vector:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1">dt_way &lt;-<span class="st"> </span>batrips[, .(start_station, end_station)]</a>
<a class="sourceLine" id="cb218-2" data-line-number="2">dt_way <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station     end_station
## 1: San Francisco City Hall Townsend at 7th
## 2: San Francisco City Hall Townsend at 7th</code></pre>
<p>Deselect start_terminal and end_terminal columns:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">drop_terminal_cols &lt;-<span class="st"> </span>batrips[, <span class="op">!</span><span class="kw">c</span>(<span class="st">&quot;start_terminal&quot;</span>, <span class="st">&quot;end_terminal&quot;</span>)]</a>
<a class="sourceLine" id="cb220-2" data-line-number="2">drop_terminal_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    trip_id duration          start_date           start_station
## 1:  139545      435 2014-01-01 00:14:00 San Francisco City Hall
## 2:  139546      432 2014-01-01 00:14:00 San Francisco City Hall
##               end_date     end_station bike_id subscription_type zip_code
## 1: 2014-01-01 00:21:00 Townsend at 7th     473        Subscriber    94612
## 2: 2014-01-01 00:21:00 Townsend at 7th     395        Subscriber    94107</code></pre>
<p>Calculate median duration using the j argument:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">median_duration &lt;-<span class="st"> </span>batrips[, <span class="kw">median</span>(duration)]</a>
<a class="sourceLine" id="cb222-2" data-line-number="2">median_duration <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## [1] 511</code></pre>
<p>Get median duration after filtering:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">median_duration_filter &lt;-<span class="st"> </span>batrips[end_station <span class="op">==</span><span class="st"> &quot;Market at 10th&quot;</span> <span class="op">&amp;</span><span class="st"> </span>subscription_type <span class="op">==</span><span class="st"> &quot;Subscriber&quot;</span>, <span class="kw">median</span>(duration)]</a>
<a class="sourceLine" id="cb224-2" data-line-number="2">median_duration_filter <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## [1] 651</code></pre>
<p>Compute duration of all trips:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">trip_duration &lt;-<span class="st"> </span>batrips[, <span class="kw">difftime</span>(end_date, start_date, <span class="dt">units =</span> <span class="st">&quot;min&quot;</span>)]</a>
<a class="sourceLine" id="cb226-2" data-line-number="2"><span class="kw">head</span>(trip_duration) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Time differences in mins
## [1] 7 7</code></pre>
<p>Have the column mean_durn:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">mean_duration &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_durn =</span> <span class="kw">mean</span>(duration))]</a>
<a class="sourceLine" id="cb228-2" data-line-number="2">mean_duration <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    mean_durn
## 1:  1131.967</code></pre>
<p>Get the min and max duration values:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">min_max_duration &lt;-<span class="st"> </span>batrips[, .(<span class="kw">min</span>(duration), <span class="kw">max</span>(duration))]</a>
<a class="sourceLine" id="cb230-2" data-line-number="2">min_max_duration <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    V1       V2
## 1: 60 17270400</code></pre>
<p>Calculate the number of unique values:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">other_stats &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration), </a>
<a class="sourceLine" id="cb232-2" data-line-number="2">                           <span class="dt">last_ride =</span> <span class="kw">max</span>(end_date))]</a>
<a class="sourceLine" id="cb232-3" data-line-number="3">other_stats <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    mean_duration           last_ride
## 1:      1131.967 2015-06-24 20:18:00</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">duration_stats &lt;-<span class="st"> </span>batrips[start_station <span class="op">==</span><span class="st"> &quot;Townsend at 7th&quot;</span> <span class="op">&amp;</span><span class="st"> </span>duration <span class="op">&lt;</span><span class="st"> </span><span class="dv">500</span>, </a>
<a class="sourceLine" id="cb234-2" data-line-number="2">                          .(<span class="dt">min_dur =</span> <span class="kw">min</span>(duration), </a>
<a class="sourceLine" id="cb234-3" data-line-number="3">                            <span class="dt">max_dur =</span> <span class="kw">max</span>(duration))]</a>
<a class="sourceLine" id="cb234-4" data-line-number="4">duration_stats</a></code></pre></div>
<pre><code>##    min_dur max_dur
## 1:      62     499</code></pre>
<p>Plot the histogram of duration based on conditions:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">batrips[start_station <span class="op">==</span><span class="st"> &quot;Townsend at 7th&quot;</span> <span class="op">&amp;</span><span class="st"> </span>duration <span class="op">&lt;</span><span class="st"> </span><span class="dv">500</span>, <span class="kw">hist</span>(duration)]</a></code></pre></div>
<p><img src="code4stem_files/figure-html/make%20histogram-1.png" width="672" /></p>
<pre><code>## $breaks
##  [1]  50 100 150 200 250 300 350 400 450 500
## 
## $counts
## [1]   28   15  792 2042  920  314  314  497  538
## 
## $density
## [1] 1.025641e-04 5.494505e-05 2.901099e-03 7.479853e-03 3.369963e-03
## [6] 1.150183e-03 1.150183e-03 1.820513e-03 1.970696e-03
## 
## $mids
## [1]  75 125 175 225 275 325 375 425 475
## 
## $xname
## [1] &quot;duration&quot;
## 
## $equidist
## [1] TRUE
## 
## attr(,&quot;class&quot;)
## [1] &quot;histogram&quot;</code></pre>
<p>Computations by groups
Compute the mean duration for every start_station:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">mean_start_stn &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration)), by =<span class="st"> </span>start_station]</a>
<a class="sourceLine" id="cb238-2" data-line-number="2">mean_start_stn <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb238-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station mean_duration
## 1: San Francisco City Hall      1893.936
## 2:  Embarcadero at Sansome      1418.182</code></pre>
<p>Compute the mean duration for every start and end station:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">mean_station &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration)), by =<span class="st"> </span>.(start_station, end_station)]</a>
<a class="sourceLine" id="cb240-2" data-line-number="2">mean_station <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station     end_station mean_duration
## 1: San Francisco City Hall Townsend at 7th      678.6364
## 2:  Embarcadero at Sansome Beale at Market      651.2367</code></pre>
<p>Compute the mean duration grouped by start_station and month:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">mean_start_station &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration)), by =<span class="st"> </span>.(start_station, <span class="kw">month</span>(start_date))]</a>
<a class="sourceLine" id="cb242-2" data-line-number="2">mean_start_station <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station month mean_duration
## 1: San Francisco City Hall     1     1548.2591
## 2:  Embarcadero at Sansome     1      952.1756</code></pre>
<p>Compute mean of duration and total trips grouped by start and end stations:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">aggregate_mean_trips &lt;-<span class="st"> </span>batrips[, .(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration), </a>
<a class="sourceLine" id="cb244-2" data-line-number="2">                                    <span class="dt">total_trips =</span> .N), </a>
<a class="sourceLine" id="cb244-3" data-line-number="3">                                by =<span class="st"> </span>.(start_station, end_station)]</a>
<a class="sourceLine" id="cb244-4" data-line-number="4">aggregate_mean_trips <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station     end_station mean_duration total_trips
## 1: San Francisco City Hall Townsend at 7th      678.6364         121
## 2:  Embarcadero at Sansome Beale at Market      651.2367         545</code></pre>
<p>Compute min and max duration grouped by start station, end station, and month:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">aggregate_min_max &lt;-<span class="st"> </span>batrips[, .(<span class="dt">min_duration =</span> <span class="kw">min</span>(duration), </a>
<a class="sourceLine" id="cb246-2" data-line-number="2">                                 <span class="dt">max_duration =</span> <span class="kw">max</span>(duration)), </a>
<a class="sourceLine" id="cb246-3" data-line-number="3">                             by =<span class="st"> </span>.(start_station, end_station, </a>
<a class="sourceLine" id="cb246-4" data-line-number="4">                                    <span class="kw">month</span>(start_date))]</a>
<a class="sourceLine" id="cb246-5" data-line-number="5">aggregate_min_max <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-6" data-line-number="6"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station     end_station month min_duration max_duration
## 1: San Francisco City Hall Townsend at 7th     1          370          661
## 2:  Embarcadero at Sansome Beale at Market     1          345         1674</code></pre>
<p>Chaining data.table expressions:
Compute the total trips grouped by start_station and end_station</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">trips_dec &lt;-<span class="st"> </span>batrips[, .N, by =<span class="st"> </span>.(start_station, </a>
<a class="sourceLine" id="cb248-2" data-line-number="2">                                  end_station)]</a>
<a class="sourceLine" id="cb248-3" data-line-number="3">trips_dec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              start_station     end_station   N
## 1: San Francisco City Hall Townsend at 7th 121
## 2:  Embarcadero at Sansome Beale at Market 545</code></pre>
<p>Arrange the total trips grouped by start_station and end_station in decreasing order:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">trips_dec &lt;-<span class="st"> </span>batrips[, .N, by =<span class="st"> </span>.(start_station, </a>
<a class="sourceLine" id="cb250-2" data-line-number="2">                                  end_station)][<span class="kw">order</span>(<span class="op">-</span>N)]</a>
<a class="sourceLine" id="cb250-3" data-line-number="3">trips_dec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##                              start_station
## 1:                         Townsend at 7th
## 2: San Francisco Caltrain 2 (330 Townsend)
##                                 end_station    N
## 1: San Francisco Caltrain (Townsend at 4th) 3158
## 2:                          Townsend at 7th 2937</code></pre>
<p>Top five most popular destinations:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">top_<span class="dv">5</span> &lt;-<span class="st"> </span>batrips[, .N, by =<span class="st"> </span>end_station][<span class="kw">order</span>(<span class="op">-</span>N)][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb252-2" data-line-number="2">top_<span class="dv">5</span></a></code></pre></div>
<pre><code>##                                 end_station     N
## 1: San Francisco Caltrain (Townsend at 4th) 33213
## 2:     Harry Bridges Plaza (Ferry Building) 15692
## 3:  San Francisco Caltrain 2 (330 Townsend) 15333
## 4:                        Market at Sansome 14816
## 5:                          2nd at Townsend 14064</code></pre>
<p>Compute most popular end station for every start station:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1">popular_end_station &lt;-<span class="st"> </span>trips_dec[, .(<span class="dt">end_station =</span> end_station[<span class="dv">1</span>]), </a>
<a class="sourceLine" id="cb254-2" data-line-number="2">                                 by =<span class="st"> </span>start_station]</a>
<a class="sourceLine" id="cb254-3" data-line-number="3">popular_end_station <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb254-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##                              start_station
## 1:                         Townsend at 7th
## 2: San Francisco Caltrain 2 (330 Townsend)
##                                 end_station
## 1: San Francisco Caltrain (Townsend at 4th)
## 2:                          Townsend at 7th</code></pre>
<p>Find the first and last ride for each start_station:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">first_last &lt;-<span class="st"> </span>batrips[<span class="kw">order</span>(start_date), </a>
<a class="sourceLine" id="cb256-2" data-line-number="2">                      .(<span class="dt">start_date =</span> start_date[<span class="kw">c</span>(<span class="dv">1</span>, .N)]), </a>
<a class="sourceLine" id="cb256-3" data-line-number="3">                      by =<span class="st"> </span>start_station]</a>
<a class="sourceLine" id="cb256-4" data-line-number="4">first_last</a></code></pre></div>
<pre><code>##                        start_station          start_date
##   1:         San Francisco City Hall 2014-01-01 00:14:00
##   2:         San Francisco City Hall 2014-12-31 22:06:00
##   3:          Embarcadero at Sansome 2014-01-01 00:17:00
##   4:          Embarcadero at Sansome 2014-12-31 22:08:00
##   5:               Steuart at Market 2014-01-01 00:23:00
##  ---                                                    
## 144: Santa Clara County Civic Center 2014-12-31 15:32:00
## 145:                     Ryland Park 2014-04-10 09:10:00
## 146:                     Ryland Park 2014-12-31 07:56:00
## 147:        Stanford in Redwood City 2014-09-03 19:41:00
## 148:        Stanford in Redwood City 2014-12-22 16:56:00</code></pre>
<p>Using .SD (I)</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1">relevant_cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;start_station&quot;</span>, <span class="st">&quot;end_station&quot;</span>, </a>
<a class="sourceLine" id="cb258-2" data-line-number="2">                   <span class="st">&quot;start_date&quot;</span>, <span class="st">&quot;end_date&quot;</span>, <span class="st">&quot;duration&quot;</span>)</a></code></pre></div>
<p>Find the row corresponding to the shortest trip per month:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">shortest &lt;-<span class="st"> </span>batrips[, .SD[<span class="kw">which.min</span>(duration)], </a>
<a class="sourceLine" id="cb259-2" data-line-number="2">                    by =<span class="st"> </span><span class="kw">month</span>(start_date), </a>
<a class="sourceLine" id="cb259-3" data-line-number="3">                    .SDcols =<span class="st"> </span>relevant_cols]</a>
<a class="sourceLine" id="cb259-4" data-line-number="4">shortest <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    month                            start_station
## 1:     1                          2nd at Townsend
## 2:     2 San Francisco Caltrain (Townsend at 4th)
##                                 end_station          start_date
## 1:                          2nd at Townsend 2014-01-21 13:01:00
## 2: San Francisco Caltrain (Townsend at 4th) 2014-02-08 14:28:00
##               end_date duration
## 1: 2014-01-21 13:02:00       60
## 2: 2014-02-08 14:29:00       61</code></pre>
<p>Using .SD (II)
Find the total number of unique start stations and zip codes per month:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">unique_station_month &lt;-<span class="st"> </span>batrips[, <span class="kw">lapply</span>(.SD, uniqueN), </a>
<a class="sourceLine" id="cb261-2" data-line-number="2">                                by =<span class="st"> </span><span class="kw">month</span>(start_date), </a>
<a class="sourceLine" id="cb261-3" data-line-number="3">                                .SDcols =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;start_station&quot;</span>, <span class="st">&quot;zip_code&quot;</span>)]</a>
<a class="sourceLine" id="cb261-4" data-line-number="4">unique_station_month <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    month start_station zip_code
## 1:     1            68      710
## 2:     2            69      591</code></pre>
<p>Adding and updating columns by reference
Add a new column, duration_hour:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">batrips[, duration_hour <span class="op">:</span><span class="er">=</span><span class="st"> </span>duration <span class="op">/</span><span class="st"> </span><span class="dv">3600</span>]</a></code></pre></div>
<p>Fix/edit spelling in the second row of start_station:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">batrips[<span class="dv">2</span>, start_station <span class="op">:</span><span class="er">=</span><span class="st"> &quot;San Francisco City Hall 2&quot;</span>]</a></code></pre></div>
<p>Replace negative duration values with NA:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">batrips[duration <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, duration <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NA</span>]</a></code></pre></div>
<p>Add a new column equal to total trips for every start station:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">batrips[, trips_N <span class="op">:</span><span class="er">=</span><span class="st"> </span>.N, by =<span class="st"> </span>start_station]</a></code></pre></div>
<p>Add new column for every start_station and end_station:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">batrips[, duration_mean <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(duration), by =<span class="st"> </span>.(start_station, end_station)]</a></code></pre></div>
<p>Calculate the mean duration for each month:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">batrips[, mean_dur <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(duration, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb268-2" data-line-number="2">            by =<span class="st"> </span><span class="kw">month</span>(start_date)]</a></code></pre></div>
<p>Replace NA values in duration with the mean value of duration for that month:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1">batrips[, mean_dur <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(duration, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb269-2" data-line-number="2">            by =<span class="st"> </span><span class="kw">month</span>(start_date)][<span class="kw">is.na</span>(duration), </a>
<a class="sourceLine" id="cb269-3" data-line-number="3">                                    duration <span class="op">:</span><span class="er">=</span><span class="st"> </span>mean_dur]</a></code></pre></div>
<p>Delete the mean_dur column by reference:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">batrips[, mean_dur <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(duration, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb270-2" data-line-number="2">            by =<span class="st"> </span><span class="kw">month</span>(start_date)][<span class="kw">is.na</span>(duration), </a>
<a class="sourceLine" id="cb270-3" data-line-number="3">                                    duration <span class="op">:</span><span class="er">=</span><span class="st"> </span>mean_dur][, mean_dur <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
<p>Add columns using the LHS := RHS form
LHS := RHS form. In the LHS, you specify column names as a character vector and in the RHS, you specify values/expressions to be added inside list() (or the alias, .()):</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">batrips[, <span class="kw">c</span>(<span class="st">&quot;mean_duration&quot;</span>, </a>
<a class="sourceLine" id="cb271-2" data-line-number="2">            <span class="st">&quot;median_duration&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span>.(<span class="kw">mean</span>(duration), <span class="kw">median</span>(duration)), </a>
<a class="sourceLine" id="cb271-3" data-line-number="3">        by =<span class="st"> </span>start_station]</a></code></pre></div>
<p>Add columns using the functional form:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1">batrips[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(duration), </a>
<a class="sourceLine" id="cb272-2" data-line-number="2">               <span class="dt">median_duration =</span> <span class="kw">median</span>(duration)), </a>
<a class="sourceLine" id="cb272-3" data-line-number="3">        by =<span class="st"> </span>start_station]</a></code></pre></div>
<p>Add the mean_duration column:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">batrips[duration <span class="op">&gt;</span><span class="st"> </span><span class="dv">600</span>, mean_duration <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(duration), </a>
<a class="sourceLine" id="cb273-2" data-line-number="2">        by =<span class="st"> </span>.(start_station, end_station)]</a></code></pre></div>
<p>Use read.csv() to import batrips
Fread is much faster!</p>
<ul>
<li>system.time(read.csv(“batrips.csv”))</li>
<li>system.time(fread(“batrips.csv”))</li>
</ul>
<p>Import using read.csv():</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1">csv_file &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">quote =</span> <span class="st">&quot;&quot;</span>, </a>
<a class="sourceLine" id="cb274-2" data-line-number="2">                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">strip.white =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb274-3" data-line-number="3">                     <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb274-4" data-line-number="4">csv_file <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb274-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   YEAR    GEO Age_group  Sex                                     Element
## 1 1980 Canada         0 Both           Number of survivors at age x (lx)
## 2 1980 Canada         0 Both Number of deaths between age x and x+1 (dx)
##   AVG_VALUE
## 1    100000
## 2       976</code></pre>
<p>Import using fread():</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1">csv_file &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>)</a>
<a class="sourceLine" id="cb276-2" data-line-number="2">csv_file <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    YEAR    GEO Age_group  Sex                                     Element
## 1: 1980 Canada         0 Both           Number of survivors at age x (lx)
## 2: 1980 Canada         0 Both Number of deaths between age x and x+1 (dx)
##    AVG_VALUE
## 1:    100000
## 2:       976</code></pre>
<p>Check the class of Sex column:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1"><span class="kw">class</span>(csv_file<span class="op">$</span>Sex)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Import using read.csv with defaults:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" data-line-number="1"><span class="kw">str</span>(csv_file)</a></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:	1048575 obs. of  6 variables:
##  $ YEAR     : int  1980 1980 1980 1980 1980 1980 1980 1980 1980 1980 ...
##  $ GEO      : chr  &quot;Canada&quot; &quot;Canada&quot; &quot;Canada&quot; &quot;Canada&quot; ...
##  $ Age_group: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Sex      : chr  &quot;Both&quot; &quot;Both&quot; &quot;Both&quot; &quot;Both&quot; ...
##  $ Element  : chr  &quot;Number of survivors at age x (lx)&quot; &quot;Number of deaths between age x and x+1 (dx)&quot; &quot;Death probability between age x and x+1 (qx)&quot; &quot;Margin of error of the death probability (m.e.(qx))&quot; ...
##  $ AVG_VALUE: num  1.00e+05 9.76e+02 9.76e-03 1.80e-04 9.90e-01 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Select “id” and “val” columns:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1">select_columns &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;GEO&quot;</span>, <span class="st">&quot;Sex&quot;</span>))</a>
<a class="sourceLine" id="cb282-2" data-line-number="2">select_columns <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##       GEO  Sex
## 1: Canada Both
## 2: Canada Both</code></pre>
<p>Drop the “val” column:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">drop_column &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">drop =</span> <span class="st">&quot;Sex&quot;</span>)</a>
<a class="sourceLine" id="cb284-2" data-line-number="2">drop_column <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    YEAR    GEO Age_group                                     Element AVG_VALUE
## 1: 1980 Canada         0           Number of survivors at age x (lx)    100000
## 2: 1980 Canada         0 Number of deaths between age x and x+1 (dx)       976</code></pre>
<p>Import the file while avoiding the warning:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1">only_data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">nrows =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb286-2" data-line-number="2">only_data</a></code></pre></div>
<pre><code>##    YEAR    GEO Age_group  Sex                                      Element
## 1: 1980 Canada         0 Both            Number of survivors at age x (lx)
## 2: 1980 Canada         0 Both  Number of deaths between age x and x+1 (dx)
## 3: 1980 Canada         0 Both Death probability between age x and x+1 (qx)
##    AVG_VALUE
## 1:  1.00e+05
## 2:  9.76e+02
## 3:  9.76e-03</code></pre>
<p>Import only the metadata:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1">only_metadata &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb288-2" data-line-number="2">only_metadata <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb288-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##      V1     V2 V3   V4                                                      V5
## 1: 1980 Canada  0 Both Cumulative number of life years lived beyond age x (Tx)
## 2: 1980 Canada  0 Both                Life expectancy (in years) at age x (ex)
##           V6
## 1: 7543058.0
## 2:      75.4</code></pre>
<p>Import using read.csv:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">base_r &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/sample.csv&quot;</span>, </a>
<a class="sourceLine" id="cb290-2" data-line-number="2">                   <span class="dt">colClasses =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;factor&quot;</span>, <span class="dv">4</span>), </a>
<a class="sourceLine" id="cb290-3" data-line-number="3">                                  <span class="st">&quot;character&quot;</span>, </a>
<a class="sourceLine" id="cb290-4" data-line-number="4">                                  <span class="st">&quot;numeric&quot;</span>))</a>
<a class="sourceLine" id="cb290-5" data-line-number="5"><span class="kw">str</span>(base_r)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:	1048575 obs. of  6 variables:
##  $ YEAR     : Factor w/ 35 levels &quot;1980&quot;,&quot;1981&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ GEO      : Factor w/ 10 levels &quot;Alberta&quot;,&quot;British Columbia&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ Age_group: Factor w/ 111 levels &quot;0&quot;,&quot;1&quot;,&quot;10&quot;,&quot;100&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Sex      : Factor w/ 3 levels &quot;Both&quot;,&quot;F&quot;,&quot;M&quot;: 1 1 1 1 1 1 1 1 1 3 ...
##  $ Element  : chr  &quot;Number of survivors at age x (lx)&quot; &quot;Number of deaths between age x and x+1 (dx)&quot; &quot;Death probability between age x and x+1 (qx)&quot; &quot;Margin of error of the death probability (m.e.(qx))&quot; ...
##  $ AVG_VALUE: num  1.00e+05 9.76e+02 9.76e-03 1.80e-04 9.90e-01 ...</code></pre>
<p>Import using fread:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1">import_fread &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, </a>
<a class="sourceLine" id="cb292-2" data-line-number="2">                      <span class="dt">colClasses =</span> <span class="kw">list</span>(<span class="dt">factor =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">numeric =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<pre><code>## Warning in fread(&quot;data/sample.csv&quot;, colClasses = list(factor = 1:4, numeric =
## 7:10)): Column number 7 (colClasses[[2]][1]) is out of range [1,ncol=6]</code></pre>
<pre><code>## Warning in fread(&quot;data/sample.csv&quot;, colClasses = list(factor = 1:4, numeric =
## 7:10)): Column number 8 (colClasses[[2]][2]) is out of range [1,ncol=6]</code></pre>
<pre><code>## Warning in fread(&quot;data/sample.csv&quot;, colClasses = list(factor = 1:4, numeric =
## 7:10)): Column number 9 (colClasses[[2]][3]) is out of range [1,ncol=6]</code></pre>
<pre><code>## Warning in fread(&quot;data/sample.csv&quot;, colClasses = list(factor = 1:4, numeric =
## 7:10)): Column number 10 (colClasses[[2]][4]) is out of range [1,ncol=6]</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1"><span class="kw">str</span>(import_fread)</a></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:	1048575 obs. of  6 variables:
##  $ YEAR     : Factor w/ 35 levels &quot;1980&quot;,&quot;1981&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ GEO      : Factor w/ 10 levels &quot;Alberta&quot;,&quot;British Columbia&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ Age_group: Factor w/ 111 levels &quot;0&quot;,&quot;1&quot;,&quot;10&quot;,&quot;100&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Sex      : Factor w/ 3 levels &quot;Both&quot;,&quot;F&quot;,&quot;M&quot;: 1 1 1 1 1 1 1 1 1 3 ...
##  $ Element  : chr  &quot;Number of survivors at age x (lx)&quot; &quot;Number of deaths between age x and x+1 (dx)&quot; &quot;Death probability between age x and x+1 (qx)&quot; &quot;Margin of error of the death probability (m.e.(qx))&quot; ...
##  $ AVG_VALUE: num  1.00e+05 9.76e+02 9.76e-03 1.80e-04 9.90e-01 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Import the file correctly, use the fill argument to ensure all rows are imported correctly:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1">correct &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb299-2" data-line-number="2">correct <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb299-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    YEAR    GEO Age_group  Sex                                     Element
## 1: 1980 Canada         0 Both           Number of survivors at age x (lx)
## 2: 1980 Canada         0 Both Number of deaths between age x and x+1 (dx)
##    AVG_VALUE
## 1:    100000
## 2:       976</code></pre>
<p>Import the file using na.strings
The missing values are encoded as “##”. Note that fread() handles an empty field ,, by default as NA</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1">missing_values &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/sample.csv&quot;</span>, <span class="dt">na.strings =</span> <span class="st">&quot;##&quot;</span>) </a>
<a class="sourceLine" id="cb301-2" data-line-number="2">missing_values <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb301-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    YEAR    GEO Age_group  Sex                                     Element
## 1: 1980 Canada         0 Both           Number of survivors at age x (lx)
## 2: 1980 Canada         0 Both Number of deaths between age x and x+1 (dx)
##    AVG_VALUE
## 1:  1.00E+05
## 2:       976</code></pre>
<p>Write dt to fwrite.txt:
- fwrite(dt, “fwrite.txt”)</p>
<p>Import the file using readLines():</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1"><span class="kw">readLines</span>(<span class="st">&quot;data/sample.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning in readLines(&quot;data/sample.csv&quot;): incomplete final line found on &#39;data/
## sample.csv&#39;</code></pre>
<pre><code>## [1] &quot;YEAR,GEO,Age_group,Sex,Element,AVG_VALUE&quot;                     
## [2] &quot;1980,Canada,0,Both,Number of survivors at age x (lx),1.00E+05&quot;</code></pre>
<p>Write batrips_dates to file using “ISO” format:
- fwrite(batrips_dates, “iso.txt”, dateTimeAs = “ISO”)</p>
<p>Write batrips_dates to file using “squash” format:
- fwrite(batrips_dates, “squash.txt”, dateTimeAs = “squash”)</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="working-with-dates-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tests-for-experiments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["code4stem.pdf", "code4stem.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
